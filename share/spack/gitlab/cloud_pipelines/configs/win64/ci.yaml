ci:
  pipeline-gen:
  - build-job:
      tags: [win64, kitware]
      # Windows CI uses Powershell
      before_script::
      - .\bin\spack_pwsh.ps1
      - spack compiler find
      # These should exist in the MSVC installation
      - spack external find --not-buildable cmake ninja
      script::
      - spack env activate --without-view ${SPACK_CONCRETE_ENV_DIR}
      - spack config add "config:install_tree:projections:${SPACK_JOB_SPEC_PKG_NAME}:'morepadding/{architecture}/{compiler.name}-{compiler.version}/{name}-{version}-{hash}'"
      - spack config add "config:install_tree:root:C:\ci\${CI_COMMIT_SHA}"
      - md ${SPACK_ARTIFACTS_ROOT}/user_data
      - spack --backtrace ci rebuild > >(tee ${SPACK_ARTIFACTS_ROOT}/user_data/pipeline_out.txt) 2> >(tee ${SPACK_ARTIFACTS_ROOT}/user_data/pipeline_err.txt >&2)
    build-job-remove:
      after_script:: [no-after-script-on-windows]
  - signing-job-remove:
      script:: [no-signing-on-windows]
